name: "Reproducible build"
on: 
  - push


jobs: 
  build: 
    runs-on: "openjdk@sha256:335627a2118556b3f412287e08ac7febb8ecc46325dc6b3570db56f32d33938f"
    steps: 
      - 
        name: "Install requirements"
        run: "apt-get update -y && \\ apt-get install -y git curl gnupg && \\ rm -rf /var/lib/apt/lists/* && \\ apt-get autoremove -y && \\ apt-get clean"
      - 
        name: "Download Release key"
        run: "gpg --keyserver https://secchannel.rsk.co/release.asc --recv-keys 1A92D8942171AFA951A857365DECF4415E3B8FA4"
      - 
        name: "Check fingerprint"
        run: "gpg --finger 1A92D8942171AFA951A857365DECF4415E3B8FA4"
      - 
        uses: actions/checkout@v2
      - 
        name: "verify SHA256SUM"
        run: "gpg --verify SHA256SUMS.asc"
      - 
        name: "check SHA256SUM"
        run: "sha256sum --check SHA256SUMS.asc"
      - 
        name: "run configure.sh"
        run: ./configure.sh
      - 
        name: build
        run: "./gradlew --no-daemon clean build -x test"
      - 
        name: "calculate hashes"
        run: "sha256sum build/libs/*"

